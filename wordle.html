<!DOCTYPE html>
<html>
<head>
	<style>
		.spaced {
			padding:10px;
			margin:15px;
			width:80%;
			height:60px;
			border-width:2px;
			align-self:center;
			font-size:40px;
		}
	</style>
</head>
<body>
<p id="playing" style="font-size:30px;"/>
<p id="auth" style="font-size:30px;"/>
<form id="verify" style="display:flex;flex-direction:column;">
	<input class="spaced" placeholder="Enter password" id="password" type="password"/>
	<input class="spaced" placeholder="3 letter word" id="three" type="text"/>
	<input class="spaced" placeholder="4 letter word" id="four" type="text"/>
	<input class="spaced" placeholder="5 letter word" id="five" type="text"/>
	<input class="spaced" type="submit"/>
</form>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC6KfUA7nkVcivPV1ZinRQJRVX--oFRVoA",
    authDomain: "sanketi-wordle.firebaseapp.com",
    databaseURL: "https://sanketi-wordle-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "sanketi-wordle",
    storageBucket: "sanketi-wordle.appspot.com",
    messagingSenderId: "553055548163",
    appId: "1:553055548163:web:79792087901a57db16ef36"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  var playing = document.getElementById("playing");
  const dbref = ref(database);
  get(child(dbref,'active')).then((snapshot)=>{
    var res = snapshot.val();
    if(res['null']) { delete res['null']; };
    console.log(res);
    var count = Object.length(res);
    playing.textContent = count.toString() + " people played recently";
  });
/*
    cyrb53 (c) 2018 bryc (github.com/bryc)
    A fast and simple hash function with decent collision resistance.
    Largely inspired by MurmurHash2/3, but with a focus on speed/simplicity.
    Public domain. Attribution appreciated.
*/
const cyrb53 = function(str, seed = 0) {
    let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
    for (let i = 0, ch; i < str.length; i++) {
        ch = str.charCodeAt(i);
        h1 = Math.imul(h1 ^ ch, 2654435761);
        h2 = Math.imul(h2 ^ ch, 1597334677);
    }
    h1 = Math.imul(h1 ^ (h1>>>16), 2246822507) ^ Math.imul(h2 ^ (h2>>>13), 3266489909);
    h2 = Math.imul(h2 ^ (h2>>>16), 2246822507) ^ Math.imul(h1 ^ (h1>>>13), 3266489909);
    return 4294967296 * (2097151 & h2) + (h1>>>0);
};

var seed = 359;
var correctHash = 3853442602068247;

const submitWords = function() {
	var three = document.getElementById("three").value;
	var four = document.getElementById("four").value;
	var five = document.getElementById("five").value;
	set(ref(database, 'current'), {
		three: three,
		four: four,
		five: five
	});
}
const form = document.getElementById("verify");
form.addEventListener('submit', (event)=>{
	event.preventDefault();
	var val = document.getElementById("password").value;
	var res = cyrb53(val,seed);
    var auth = document.getElementById("auth");
    if(res==correctHash) {
    	auth.textContent = "Correct password, these words have been submitted as daily words!";
        submitWords();
    } else {
    	auth.textContent = "Incorrect password. Please try again.";
    }
});


</script>
</body>
</html>
